# Domain Management Commands

Commands for managing reserved domains in Keeper Enterprise

---

## Overview

Keeper Commander provides domain management capabilities for enterprise administrators to reserve and manage domains. These commands allow Root Admins to claim domains for their enterprise, ensuring that user accounts with email addresses from these domains can only be created within the authorized enterprise.

**What's a Reserved Domain?** A reserved domain is a DNS domain (e.g., `company.com`) that has been verified and registered to a specific Keeper enterprise. Once reserved, only that enterprise can create accounts with email addresses from that domain, preventing unauthorized account creation.

**Domain Verification:** Reserving a domain requires DNS verification using a TXT record to prove ownership of the domain.

---

## User Commands

### Enterprise Administrator Commands

These commands are available to **Root Administrators** for managing enterprise domains:

* `**list-domains**` – View all reserved domains for your enterprise
* `**reserve-domain**` – Reserve, verify, or remove domains from your enterprise

With these commands, Root Admins can enforce email domain policies, prevent unauthorized account creation, and maintain organizational control over user provisioning.

---

## Terminology

The table below describes domain management terminology used in Keeper's platform.

| Terminology | Description |
|------------|-------------|
| **Reserved Domain** | A DNS domain that has been verified and claimed by an enterprise. Only this enterprise can create user accounts with email addresses from this domain. |
| **Domain Verification** | The process of proving domain ownership by adding a DNS TXT record containing a Keeper-provided token. |
| **Verification Token** | A unique string generated by Keeper that must be added to your domain's DNS TXT records to prove ownership. |
| **Root Admin** | The highest level of administrative access in Keeper Enterprise, required to manage reserved domains. |

---

## Domain Management Commands

### `list-domains` - List Reserved Domains

Lists all domains currently reserved for your enterprise.

**Command Syntax**

```bash
list-domains [--format=FORMAT] [--output=FILE]
```

**Alias:** `ld`

**Parameters**

* `--format`: Output format (`table` or `json`). Default: `table`
* `--output`: Output file name for exporting results

**Permission Required:** Root Admin

**Examples**

#### Example 1: Display reserved domains in table format

```bash
My Vault> list-domains
Domain Name
example.com
company.com
enterprise.net
```

#### Example 2: Display reserved domains as JSON

```bash
My Vault> list-domains --format=json
[
  "example.com",
  "company.com",
  "enterprise.net"
]
```

#### Example 3: Save domain list to file

```bash
My Vault> list-domains --format=json --output=domains.json
Results saved to domains.json
```

#### Example 4: Using alias command

```bash
My Vault> ld
Domain Name
example.com
company.com
```

---

### `reserve-domain` - Reserve and Manage Domains

Reserve, verify, or remove domains from your enterprise. This command supports a three-step workflow for domain verification.

**Command Syntax**

```bash
reserve-domain --action=ACTION --domain=DOMAIN
```

**Alias:** `rd`

**Parameters**

* `--action`: Required. Action to perform:
  * `token` – Generate verification token for DNS
  * `add` – Add domain after DNS verification
  * `delete` – Remove reserved domain
* `--domain`: Required. The domain name to manage (e.g., `example.com`)

**Permission Required:** Root Admin

---

## Domain Reservation Workflow

### Step 1: Generate Verification Token

Generate a DNS verification token for your domain.

**Command Syntax**

```bash
reserve-domain --action token --domain DOMAIN
```

**Examples**

#### Example 1: Generate token for domain

```bash
My Vault> reserve-domain --action token --domain example.com

Token generated successfully!

Domain: example.com
Token:  keeper-domain-verification=abc123def456ghi789

Next steps:
1. Log into your domain registrar or DNS provider
2. Add a TXT record for domain "example.com" with value:
   keeper-domain-verification=abc123def456ghi789
3. Wait for DNS propagation (may take a few minutes)
4. Run: reserve-domain --action add --domain example.com
```

#### Example 2: Using alias

```bash
My Vault> rd --action token --domain company.com

Token generated successfully!

Domain: company.com
Token:  keeper-domain-verification=xyz987uvw654rst321
```

---

### Step 2: Add Domain After Verification

After adding the TXT record to your DNS, verify and reserve the domain.

**Command Syntax**

```bash
reserve-domain --action add --domain DOMAIN
```

**Examples**

#### Example 1: Add verified domain

```bash
My Vault> reserve-domain --action add --domain example.com
✓ Domain "example.com" successfully added to enterprise!
```

#### Example 2: Add domain - verification failed

```bash
My Vault> reserve-domain --action add --domain example.com
Error: Domain verification failed. Ensure the TXT record is properly configured and DNS has propagated.
```

---

### Step 3: Remove Reserved Domain

Remove a domain from your enterprise's reserved list.

**Command Syntax**

```bash
reserve-domain --action delete --domain DOMAIN
```

**Examples**

#### Example 1: Remove domain

```bash
My Vault> reserve-domain --action delete --domain old-company.com
✓ Domain "old-company.com" successfully removed from enterprise
```

#### Example 2: Remove non-existent domain

```bash
My Vault> reserve-domain --action delete --domain unknown.com
Error: Domain "unknown.com" does not exist. Use action "token" to start the domain reservation process.
```

---

## Error Handling

The domain management commands provide detailed error messages for common scenarios:

| Error Type | Message | Resolution |
|-----------|---------|------------|
| **Access Denied** | "Access denied: You must be a Root Admin to manage domains" | Ensure you have Root Admin privileges |
| **Domain Already Exists** | "Domain already exists in the enterprise" | Domain is already reserved. Use `delete` action to remove it first |
| **Domain Not Found** | "Domain does not exist" | Use `token` action to start the reservation process |
| **Domain Taken** | "Domain is already reserved by a different enterprise" | This domain is claimed by another Keeper enterprise |
| **Verification Failed** | "Domain verification failed" | Check DNS TXT record configuration and wait for propagation |
| **Invalid Domain** | "Bad request: Domain not specified or invalid" | Verify the domain name format is correct |

---

## DNS Configuration Guide

### Adding TXT Record for Domain Verification

#### Step-by-Step Process

1. **Generate Token**
   ```bash
   reserve-domain --action token --domain example.com
   ```
   
2. **Access DNS Provider**
   - Log into your domain registrar or DNS hosting provider (e.g., GoDaddy, Cloudflare, Route53, Namecheap)

3. **Add TXT Record**
   - **Record Type:** TXT
   - **Host/Name:** `@` (root domain) or `example.com`
   - **Value:** `keeper-domain-verification=abc123def456ghi789` (use your actual token)
   - **TTL:** 3600 (or default)

4. **Wait for Propagation**
   - DNS changes typically propagate within 5-30 minutes
   - Some providers may take up to 48 hours

5. **Verify Domain**
   ```bash
   reserve-domain --action add --domain example.com
   ```

#### Common DNS Providers Configuration

**Cloudflare:**
- Type: TXT
- Name: `@`
- Content: `keeper-domain-verification=YOUR_TOKEN`
- TTL: Auto

**AWS Route 53:**
- Record name: `example.com`
- Record type: TXT
- Value: `"keeper-domain-verification=YOUR_TOKEN"`
- Routing policy: Simple

**GoDaddy:**
- Type: TXT
- Host: `@`
- TXT Value: `keeper-domain-verification=YOUR_TOKEN`
- TTL: 1 Hour

---

## Complete Workflow Example

Here's a complete example of reserving a new domain:

```bash
# Step 1: List current domains
My Vault> list-domains
Domain Name
company.com

# Step 2: Generate token for new domain
My Vault> reserve-domain --action token --domain newacquisition.com

Token generated successfully!

Domain: newacquisition.com
Token:  keeper-domain-verification=def789ghi123jkl456

Next steps:
1. Log into your domain registrar or DNS provider
2. Add a TXT record for domain "newacquisition.com" with value:
   keeper-domain-verification=def789ghi123jkl456
3. Wait for DNS propagation (may take a few minutes)
4. Run: reserve-domain --action add --domain newacquisition.com

# Step 3: [User adds TXT record to DNS]
# ... waiting for DNS propagation ...

# Step 4: Add domain after verification
My Vault> reserve-domain --action add --domain newacquisition.com
✓ Domain "newacquisition.com" successfully added to enterprise!

# Step 5: Verify the domain was added
My Vault> list-domains
Domain Name
company.com
newacquisition.com
```

---

## Use Cases

### Enterprise Onboarding
When acquiring a new company or adding a new domain to your organization, reserve the domain to ensure all user accounts are properly managed within your Keeper enterprise.

### Security Compliance
Reserve all company domains to prevent unauthorized individuals from creating Keeper accounts using your company email addresses.

### Multi-Domain Organizations
Organizations with multiple domains (e.g., `company.com`, `company.net`, `subsidiary.com`) can reserve all domains for centralized management.

### Domain Migration
When migrating from one domain to another, reserve the new domain before transitioning users, then remove the old domain after migration is complete.

---

## Best Practices

1. **Reserve All Company Domains**: Reserve primary and subsidiary domains to maintain control
2. **Document DNS Changes**: Keep records of DNS TXT records for audit purposes
3. **Test Before Production**: Verify DNS propagation before adding domains
4. **Regular Audits**: Periodically review reserved domains using `list-domains`
5. **Remove Unused Domains**: Delete domains that are no longer in use
6. **Coordinate with IT**: Work with your DNS/IT team for TXT record configuration
7. **Monitor Access**: Ensure only Root Admins have domain management access

---

## Troubleshooting

### Token Generation Issues

**Problem:** Unable to generate token
- **Check:** Verify you have Root Admin permissions
- **Check:** Ensure domain isn't already reserved
- **Solution:** Use `list-domains` to verify current status

### DNS Verification Failures

**Problem:** Domain verification fails with `add` action
- **Check:** Verify TXT record is correctly configured
- **Check:** Use DNS lookup tools (e.g., `nslookup`, `dig`) to verify TXT record
- **Check:** Wait additional time for DNS propagation
- **Solution:** Re-run verification after confirming DNS changes

```bash
# Verify TXT record using dig
dig TXT example.com

# Verify TXT record using nslookup
nslookup -type=TXT example.com
```

### Domain Already Taken

**Problem:** "Domain is already reserved by a different enterprise"
- **Cause:** Another Keeper enterprise has already claimed this domain
- **Solution:** Contact Keeper Support to verify domain ownership and potentially transfer the domain

### Permission Denied

**Problem:** "Access denied: You must be a Root Admin"
- **Check:** Verify your role in the enterprise
- **Solution:** Contact your enterprise's Root Admin to grant appropriate permissions

---

## Command Reference Summary

| Command | Alias | Action | Description | Permission |
|---------|-------|--------|-------------|------------|
| `list-domains` | `ld` | - | List all reserved domains | Root Admin |
| `reserve-domain` | `rd` | `token` | Generate verification token | Root Admin |
| `reserve-domain` | `rd` | `add` | Add verified domain | Root Admin |
| `reserve-domain` | `rd` | `delete` | Remove reserved domain | Root Admin |

---

## Related Commands

* `enterprise-info` – View enterprise information and settings
* `enterprise-user` – Manage enterprise users
* `user-report` – Generate user reports with email domains

---

## Additional Resources

* [Enterprise Management Commands](https://docs.keeper.io/en/keeperpam/commander-cli/command-reference/enterprise-management-commands)
* [Keeper Commander Overview](https://docs.keeper.io/en/keeperpam/commander-cli/commander-overview)
* [Installation and Setup](https://docs.keeper.io/en/keeperpam/commander-cli/installation-and-setup)

---

**Last updated:** January 2025

**Documentation Version:** 1.0

---

For more information about Keeper Commander, visit the [Commander CLI Documentation](https://docs.keeper.io/en/keeperpam/commander-cli).

